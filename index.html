<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Auto 3D AMV â€” Browser + HF Spaces</title>
  <link rel="stylesheet" href="styles.css"/>

  <!-- (Optional) CSP that allows our CDNs and data/blob URIs -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' https://unpkg.com https://cdn.jsdelivr.net;
                 img-src 'self' data: blob: https:;
                 media-src 'self' blob:;
                 connect-src 'self' https:;
                 script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net;
                 style-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net;">

  <!-- Three.js core (defines global window.THREE) with CDN fallback -->
  <script src="https://unpkg.com/three@0.161.0/build/three.min.js"
          crossorigin="anonymous"
          onerror="(function(){var s=document.createElement('script');s.src='https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js';s.crossOrigin='anonymous';document.head.appendChild(s);}())"></script>

  <!-- Non-module example helpers (FontLoader/TextGeometry) with fallback -->
  <script src="https://unpkg.com/three@0.161.0/examples/js/loaders/FontLoader.js"
          crossorigin="anonymous"
          onerror="(function(){var s=document.createElement('script');s.src='https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/loaders/FontLoader.js';s.crossOrigin='anonymous';document.head.appendChild(s);}())"></script>
  <script src="https://unpkg.com/three@0.161.0/examples/js/geometries/TextGeometry.js"
          crossorigin="anonymous"
          onerror="(function(){var s=document.createElement('script');s.src='https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/geometries/TextGeometry.js';s.crossOrigin='anonymous';document.head.appendChild(s);}())"></script>

  <!-- Hard guarantee: if THREE is still missing (e.g., due to caching), inject fallback now -->
  <script>
    if (!window.THREE) {
      document.write('<script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js" crossorigin="anonymous"><\/script>');
    }
  </script>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ðŸŽ¬ Auto 3D AMV â€” Browser + HF Spaces (Free)</h1>
      <p>No installs. AI backgrounds via free Hugging Face Spaces endpoints.</p>
    </header>

    <section class="controls">
      <div class="col">
        <label>Project Title</label>
        <input id="title" placeholder="My Song"/>
        <label>Style Brief</label>
        <input id="style" value="Fun, upbeat, colorful 3D for kids; Pixar-like; classroom stage"/>
        <label>Lyrics (paste)</label>
        <textarea id="lyrics" rows="8" placeholder="Paste lyrics..."></textarea>
      </div>
      <div class="col">
        <label>Audio (WAV/MP3)</label>
        <input id="audio" type="file" accept=".wav,.mp3"/>
        <label>Hugging Face Space URL</label>
        <input id="space" placeholder="https://your-username-your-space.hf.space"/>
        <small>Public CPU Space is fine. Must accept POST /api/predict or /run/predict with a text prompt and return an image.</small>
        <div class="btns">
          <button id="genBtn">Generate Full Video</button>
          <button id="stopBtn" disabled>Stop</button>
        </div>
        <div class="status" id="status">Idle</div>
        <div class="download" id="download"></div>
      </div>
    </section>

    <section class="stage">
      <canvas id="stage"></canvas>
    </section>

    <footer>
      <small>Host these static files on GitHub Pages / Cloudflare Pages / Netlify â€” free.
      The app calls your HF Space directly from the browser.</small>
    </footer>
  </div>

  <!-- Your app logic (must come AFTER three.js) -->
  <script src="app.js"></script>
</body>
</html>
